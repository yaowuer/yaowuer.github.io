<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2019-07-26 Fri 01:37 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Java Web</title>
<meta name="generator" content="Org mode">
<meta name="author" content="yaowuer">
<link rel='stylesheet' href='/asset/common.css' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/asset/common.js'></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">Java Web</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb8e28fe">1. 预习</a></li>
<li><a href="#orgaa362a8">2. CS vs BS</a></li>
<li><a href="#org1222a59">3. Servlet</a>
<ul>
<li><a href="#org6680e4a">3.1. 规范</a></li>
<li><a href="#orga806116">3.2. Tomcat 容器</a></li>
<li><a href="#org6e2754a">3.3. hello-world</a></li>
<li><a href="#org8b770e5">3.4. Servlet</a>
<ul>
<li><a href="#org801f83e">3.4.1. 请求流程</a></li>
<li><a href="#orgc5aae04">3.4.2. Servlet/HttpServlet</a></li>
<li><a href="#org3860a2f">3.4.3. 配置方式</a></li>
<li><a href="#orgbddf1b9">3.4.4. forward/redirect，转发 vs 重定向</a></li>
</ul>
</li>
<li><a href="#orgde5d119">3.5. Filter &lt;过滤器&gt;</a></li>
<li><a href="#org0ee7a94">3.6. EventListener &lt;监听器&gt;</a></li>
<li><a href="#org21f545a">3.7. 生命周期 (Lifecycle)</a></li>
<li><a href="#org1c7e5c0">3.8. 标准 WAR 结构</a></li>
</ul>
</li>
<li><a href="#org843863a">4. JSP</a>
<ul>
<li><a href="#org58e2c82">4.1. 认识 JSP</a></li>
<li><a href="#org87a6c48">4.2. 内置对象</a></li>
<li><a href="#org1a7046f">4.3. JSP 指令</a></li>
<li><a href="#org6f53342">4.4. JSP 动作元素</a></li>
<li><a href="#org075e934">4.5. EL 表达式 (Expression Language)</a></li>
<li><a href="#org02fc594">4.6. JSTL 标准标签库</a></li>
<li><a href="#org4003803">4.7. 将其他页面包含到本页面</a></li>
</ul>
</li>
<li><a href="#orgbab26bd">5. Cookie/Session</a>
<ul>
<li><a href="#org7eca1a2">5.1. Cookie</a></li>
<li><a href="#org4540278">5.2. Session</a></li>
</ul>
</li>
<li><a href="#orgf163059">6. 文件的上传和下载</a></li>
<li><a href="#orgaf79d1c">7. 用户的注册和登录</a></li>
<li><a href="#org3c9f3e9">8. 完整的增删改查实现</a></li>
</ul>
</div>
</nav>


<section id="outline-container-orgb8e28fe" class="outline-2">
<h2 id="orgb8e28fe"><span class="section-number-2">1</span> 预习</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>下载 Tomcat 服务器，完成安装</li>
<li>了解 Tomcat 的目录结构，并学会基本配置</li>
<li>将 Tomcat 配置到 eclipse/idea 中</li>
<li>了解 Servlet/jsp 的基本概念</li>
</ul>
</div>
</section>

<section id="outline-container-orgaa362a8" class="outline-2">
<h2 id="orgaa362a8"><span class="section-number-2">2</span> CS vs BS</h2>
<div class="outline-text-2" id="text-2">
<p>
Client-Server，客户端-服务端:
</p>
<ul class="org-ul">
<li>需要安装独立的应用程序</li>
<li>开发语言丰富多彩，比如 WinForm/WPF/QT/JavaFx
<ul class="org-ul">
<li>优点，灵活、强大、可定制性强</li>
<li>缺点，对于开发者来说，开发起来麻烦，开发需要掌握的基本知识太多。对于用户来说，必须要下载并安装单独的应用</li>
</ul></li>
<li>需要网络进行交互 (tcp/ip协议，socket 编程)</li>
</ul>

<p>
Browser-Server，浏览器-服务器:
</p>
<ul class="org-ul">
<li>借助浏览器进行更多底层任务的执行</li>
<li>为了渲染页面，推出了一套规则，叫 html</li>
<li>后来 html 虽然能渲染数据，但不够好看，所以就诞生了 css</li>
<li>后来虽然有了 css 的加持，页面好看了，但是页面不会动，也让人觉得不够爽</li>
<li>所以，就产生了 JavaScript，官方的称呼为 ECMAScript，简称 ES</li>
</ul>

<p>
Web 的时代就这样来临了。
</p>

<p>
大前端统一江湖的梦想就诞生了。
</p>
</div>
</section>

<section id="outline-container-org1222a59" class="outline-2">
<h2 id="org1222a59"><span class="section-number-2">3</span> Servlet</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org6680e4a" class="outline-3">
<h3 id="org6680e4a"><span class="section-number-3">3.1</span> 规范</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Servlet3.1 规范 <a href="https://github.com/waylau/servlet-3.1-specification">中文版</a> <a href="https://jcp.org/en/jsr/detail?id=340">英文版</a>
</p>

<p>
Servlet 规范是 JCP 组织推出的一套，如何使用 Java 进行 Web 编程的规范。它本身只包含一份概念的 pdf，还有一个包含着基本接口的 Jar 包。
</p>

<p>
Servlet 规范是对所有人开放的，只要你原因，你就可以按照规范上的规定，自行去设计相关的基于 Java 的 Web 服务器。
</p>

<p>
其中，比较流行的是:
</p>
<ul class="org-ul">
<li>Apache Tomcat</li>
<li>Jetty</li>
<li>Weblogic</li>
<li>Websphare</li>
<li>JBoss</li>
</ul>

<p>
他们是基于 Java 进行 Web 编程的服务器，也可以看做是 Servlet 容器。
</p>
</div>
</div>

<div id="outline-container-orga806116" class="outline-3">
<h3 id="orga806116"><span class="section-number-3">3.2</span> Tomcat 容器</h3>
<div class="outline-text-3" id="text-3-2">
<p>
这是 Tomcat 的目录结构，也是常见开源项目的标准目录结构:
</p>


<figure>
<img src="img/scrot_2019-06-26_02-57-48.png" alt="scrot_2019-06-26_02-57-48.png">

</figure>
</div>
</div>

<div id="outline-container-org6e2754a" class="outline-3">
<h3 id="org6e2754a"><span class="section-number-3">3.3</span> hello-world</h3>
<div class="outline-text-3" id="text-3-3">
<p>
WorldServlet.java:
</p>


<figure>
<img src="img/scrot_2019-07-04_01-01-12.png" alt="scrot_2019-07-04_01-01-12.png">

</figure>

<p>
web.xml:
</p>


<figure>
<img src="img/scrot_2019-07-04_01-01-50.png" alt="scrot_2019-07-04_01-01-50.png">

</figure>
</div>
</div>

<div id="outline-container-org8b770e5" class="outline-3">
<h3 id="org8b770e5"><span class="section-number-3">3.4</span> Servlet</h3>
<div class="outline-text-3" id="text-3-4">
</div>
<div id="outline-container-org801f83e" class="outline-4">
<h4 id="org801f83e"><span class="section-number-4">3.4.1</span> 请求流程</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
请求的地址是:
</p>
<ul class="org-ul">
<li><a href="http://localhost:8888/w1/zzz.html">http://localhost:8888/w1/zzz.html</a></li>
</ul>

<p>
Tomcat 拿到地址后，除去 schema://host:port/contextPath，得到:
</p>
<ul class="org-ul">
<li><code>/zzz.html</code></li>
</ul>

<p>
接下来，到 web.xml 中，去匹配这个 url，得到相应的要处理的 Servlet 类:
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span class="org-function-name">servlet-mapping</span>&gt;
  &lt;<span class="org-function-name">servlet-name</span>&gt;worldServlet&lt;/<span class="org-function-name">servlet-name</span>&gt;
  &lt;<span class="org-function-name">url-pattern</span>&gt;/zzz.html&lt;/<span class="org-function-name">url-pattern</span>&gt;
&lt;/<span class="org-function-name">servlet-mapping</span>&gt;
</pre>
</div>

<p>
调用 servlet 里的 service 方法，得到返回的字符串，响应给客户端。
</p>

<p>
最后，客户端，将获取到的响应字符串，渲染到浏览器里面。
</p>

<p>
TODO: 自己搜索、整理一下，url-pattern 的匹配机制。
</p>
</div>
</div>

<div id="outline-container-orgc5aae04" class="outline-4">
<h4 id="orgc5aae04"><span class="section-number-4">3.4.2</span> Servlet/HttpServlet</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
如果要使用 Java 提供一个 Web 服务，只需要:
</p>
<ul class="org-ul">
<li>写一个类，这个类实现 <code>Servlet</code> 接口即可。在 Servlet 接口的 service 方法内，处理请求，并返回结果到客户端</li>
<li>上述实现的类就是一个 Servlet，然后只需要将其编译并部署到 Servlet 容器里即可。部署的意思是放到 Servlet 容器的指定位置，并配置合适的访问的 url</li>
<li>常见的 Servlet 容器是 Tomcat，它不仅具备解析 Servlet 类的功能，还能提供基本的 Web 服务器功能</li>
</ul>

<p>
由上可见，如果提供服务，只需要实现接口。可实际上，我们大多数 Web 服务都是基于 Http 请求的。
HTTP 协议有自己的一些独特规则，比如 http method 等，所以为了能更方便处理基于 HTTP 协议的服务，标准中又提供了一个针对性的 HttpServlet 类。一般来说，我们创建 Servlet，只需要继承这个类即可。
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">MyServlet</span> <span class="org-keyword">extends</span> <span class="org-type">HttpServlet</span> {...}
</pre>
</div>

<p>
之后，就<b>不需要理会 service 方法</b>了，而是将相应的逻辑写到对应 http method 的 doGet/doPost/doDelete 等方法中即可。
</p>

<div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">MyServlet</span> <span class="org-keyword">extends</span> <span class="org-type">HttpServlet</span> {
    <span class="org-function-name">@Override</span>
    doGet(<span class="org-type">req</span>, <span class="org-type">resp</span>) {
    }

    <span class="org-function-name">@Override</span>
    doPost(<span class="org-type">req</span>, <span class="org-type">resp</span>) {
    }
}
</pre>
</div>

<p>
即:
</p>
<pre class="example">
请求 -&gt; 对应 Servlet -&gt; 对应 doGet/doPost 方法 -&gt; 响应
</pre>
</div>
</div>

<div id="outline-container-org3860a2f" class="outline-4">
<h4 id="org3860a2f"><span class="section-number-4">3.4.3</span> 配置方式</h4>
<div class="outline-text-4" id="text-3-4-3">
<p>
xml 方式。
</p>

<p>
注解方式。
</p>
</div>
</div>

<div id="outline-container-orgbddf1b9" class="outline-4">
<h4 id="orgbddf1b9"><span class="section-number-4">3.4.4</span> forward/redirect，转发 vs 重定向</h4>
<div class="outline-text-4" id="text-3-4-4">
<p>
转发的语法:
</p>
<div class="org-src-container">
<pre class="src src-java">request.getRequestDispatcher(<span class="org-string">"/xxx"</span>).forward(request, response);
</pre>
</div>

<p>
重定向的语法:
</p>
<div class="org-src-container">
<pre class="src src-java">response.sendRedirect(<span class="org-string">"/s/xxx"</span>);
</pre>
</div>

<ul class="org-ul">
<li><b>转发</b> (forward)是服务器端的内部行为，是指当前的 servlet 将接下来的任务交给了(即转发给了)另外一个 servlet/jsp 去继续处理</li>
<li>客户端是不会察觉到转发的行为的，因为它的进行仅存在于服务端</li>
<li><b>重定向</b> (redirect)是服务器借助 HTTP 请求中的 302 返回码，将接下来要处理任务的 url 通知客户端，并让客户端请求新的 url 从而完成剩下的任务</li>
<li>一个请求中，如果有重定向，那么客户端实质上是发送了多个请求。如果追踪 http 的通讯，会发现 30x 的返回</li>
<li>转发，会存在刷新重复的问题；重定向不会，因为它只是重新进行最后一个请求，这个请求一般不会带一些<b>写</b>相关的逻辑</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgde5d119" class="outline-3">
<h3 id="orgde5d119"><span class="section-number-3">3.5</span> Filter &lt;过滤器&gt;</h3>
<div class="outline-text-3" id="text-3-5">
<p>
将多个可以重用的逻辑，抽离出来，以达到<b>复用</b>目的。
</p>

<p>
可以配置使对个请求，在到达、离开对应 Servlet 的 doXxx 方法时，都会经过这个逻辑。
</p>

<p>
应用场景:
</p>
<ul class="org-ul">
<li>编码设置</li>
<li>登录控制、权限控制</li>
<li>日志记录</li>
</ul>

<p>
使用步骤:
</p>
<ol class="org-ol">
<li>定义过滤器</li>
<li>配置使用
<ul class="org-ul">
<li>web.xml 方式</li>
<li>注解 @WebFilter("/*")</li>
</ul></li>
</ol>

<p>
注意:
</p>
<ul class="org-ul">
<li>可以配置多个过滤器</li>
<li>多个过滤器形成<b>链式</b>结构，依次调用 doChain</li>
<li>调用的顺序，跟配置的顺序有关</li>
</ul>
</div>
</div>

<div id="outline-container-org0ee7a94" class="outline-3">
<h3 id="org0ee7a94"><span class="section-number-3">3.6</span> EventListener &lt;监听器&gt;</h3>
<div class="outline-text-3" id="text-3-6">
<p>
在某些事件发生的时候，执行的逻辑:
</p>
<ul class="org-ul">
<li>应用启动的时候 ContextListener</li>
<li>request 对象创建、销毁的时候</li>
<li>session 对象创建、销毁的时候</li>
<li>session 激活、失效的时候</li>
<li>session 设置、删除、更新值的时候</li>
</ul>

<p>
使用步骤:
</p>
<ol class="org-ol">
<li>创建，实现 EventListener 接口</li>
<li>在 web.xml 中注册，也可以使用 @WebListener 注解进行注册</li>
</ol>
</div>
</div>

<div id="outline-container-org21f545a" class="outline-3">
<h3 id="org21f545a"><span class="section-number-3">3.7</span> 生命周期 (Lifecycle)</h3>
<div class="outline-text-3" id="text-3-7">
<p>
Servlet:
</p>
<ol class="org-ol">
<li>延迟加载（按需加载）</li>
<li>单例模式（效率高，线程不安全）</li>
</ol>

<p>
基本函数:
</p>
<ul class="org-ul">
<li>init，是在 Servlet 初始化实例的时候执行的</li>
<li>service</li>
<li>destroy，实在服务器关闭的时候执行的，一般用来做一些清理工作</li>
</ul>

<p>
Listener/Filter 亦复如是。
</p>
</div>
</div>

<div id="outline-container-org1c7e5c0" class="outline-3">
<h3 id="org1c7e5c0"><span class="section-number-3">3.8</span> 标准 WAR 结构</h3>
<div class="outline-text-3" id="text-3-8">
<p>
一个 Java Web 项目编译之后的目录结构是这样的:
</p>


<figure>
<img src="img/scrot_2019-07-26_01-31-35.png" alt="scrot_2019-07-26_01-31-35.png">

</figure>

<p>
其中:
</p>
<ul class="org-ul">
<li>所有的 <code>src/*.java</code> 会被编译到 <code>/WEB-INF/classes/*.class</code> 下</li>
<li>所有依赖的 jar 包，都会被编译到 <code>/WEB-INF/lib/*.jar</code> 下</li>
<li><code>/WEB-INF/web.xml</code> 是核心配置文件。在 servlet3 之后，已非必须。</li>
</ul>

<p>
另外:
</p>
<ul class="org-ul">
<li>如果要部署到服务器上，可以直接将这个目录 copy 到 <code>$TOMCAT_HOME/webapp/</code> 下面</li>
<li>另外，可以将其压缩为 <code>WAR</code> 格式后，扔到 <code>$TOMCAT_HOME/webapp/</code> 下。WAR 是 java web 的专有压缩格式。</li>
</ul>
</div>
</div>
</section>

<section id="outline-container-org843863a" class="outline-2">
<h2 id="org843863a"><span class="section-number-2">4</span> JSP</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org58e2c82" class="outline-3">
<h3 id="org58e2c82"><span class="section-number-3">4.1</span> 认识 JSP</h3>
<div class="outline-text-3" id="text-4-1">
<p>
为什么要有 JSP:
</p>
<ol class="org-ol">
<li>如果进行 Web 通信，一般要返回的内容都是符合 html 格式的文本字符串</li>
<li>Servlet 功能非常强大，但是要将结果渲染成 html 字符串，务必要进行麻烦的字符串拼接等，开发效率低</li>
<li>我们需要一种<b>模板</b>，能更好将数据渲染成客户端需要的样子，即产生 html 字符串</li>
</ol>
</div>
</div>

<div id="outline-container-org87a6c48" class="outline-3">
<h3 id="org87a6c48"><span class="section-number-3">4.2</span> 内置对象</h3>
<div class="outline-text-3" id="text-4-2">
<p>
<code>request/response/application/config/session/out/pageContext</code>
</p>
</div>
</div>

<div id="outline-container-org1a7046f" class="outline-3">
<h3 id="org1a7046f"><span class="section-number-3">4.3</span> JSP 指令</h3>
<div class="outline-text-3" id="text-4-3">
<ul class="org-ul">
<li><code>&lt;%@ include file="xxx.jsp" %&gt;</code></li>
<li><code>&lt;%@ taglib prefix="c" uri="xxx.tld" %&gt;</code></li>
<li><code>&lt;%@ page import/errorPage/language/pageEncoding/contentType/... %&gt;</code></li>
</ul>
</div>
</div>

<div id="outline-container-org6f53342" class="outline-3">
<h3 id="org6f53342"><span class="section-number-3">4.4</span> JSP 动作元素</h3>
<div class="outline-text-3" id="text-4-4">
<p>
<code>&lt;jsp:include/forward/useBean/setProperty/getProperty...&gt;</code>
</p>
</div>
</div>

<div id="outline-container-org075e934" class="outline-3">
<h3 id="org075e934"><span class="section-number-3">4.5</span> EL 表达式 (Expression Language)</h3>
<div class="outline-text-3" id="text-4-5">
<p>
JSP 的主要任务是: 拿到现成的数据，然后渲染。
</p>

<p>
使用 <code>&lt;% xxxx %&gt;</code> 去取的话，有些啰嗦，所以需要简化。
</p>

<p>
JSP 2.0 之后，就开始支持在 JSP 页面中<b>嵌入</b>类似 <code>${xxx}</code> 代码，这被称作 EL 表达式。
</p>

<div class="org-src-container">
<pre class="src src-html"><span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#20174;&#19981;&#21516;&#33539;&#22260;&#20869;&#21462;&#20540; </span><span class="org-comment-delimiter">--&gt;</span>
${pageScope.xxx} | ${pageScope[<span class="org-string">"xxx"</span>]
${requestScope.xxx} <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">request.getAttribute("xxx") </span><span class="org-comment-delimiter">--&gt;</span>
${sessionScope.yyy} <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">session.getAttribute("yyy") </span><span class="org-comment-delimiter">--&gt;</span>
${applicationScope.zzz} <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">application.getAttribute("zzz") </span><span class="org-comment-delimiter">--&gt;</span>

<span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#19979;&#38754;&#20363;&#23376;&#65292;&#20004;&#20010;&#28857;&#26159;&#19981;&#19968;&#26679;&#30340;: </span><span class="org-comment-delimiter">--&gt;</span>
<span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&gt; &#31532;&#19968;&#20010;&#34920;&#31034; getAttribute:  Book book = (Book) request.getAttrubite("book"); </span><span class="org-comment-delimiter">--&gt;</span>
<span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&gt; &#31532;&#20108;&#20010;&#34920;&#31034;&#35843;&#29992; get &#26041;&#27861;:   book.getName() </span><span class="org-comment-delimiter">--&gt;</span>
${requestScope.book.name}
${requestScope.book.getName()} <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#36319;&#19978;&#38754;&#30340;&#31561;&#21516; </span><span class="org-comment-delimiter">--&gt;</span>

<span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#21487;&#20197;&#32487;&#32493;&#31616;&#21270;&#65292;&#23558; xxxScope &#21435;&#25481; </span><span class="org-comment-delimiter">--&gt;</span>
<span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#20250;&#25353;&#29031; pageScope -&gt; requestScope -&gt; sessionScope -&gt; applicationScope &#30340;&#39034;&#24207;&#21435;&#23547;&#25214; attribute &#25968;&#25454;  </span><span class="org-comment-delimiter">--&gt;</span>
${age} ${name}
${book.name}

<span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#20854;&#20182;&#30340;&#38544;&#34255;&#23545;&#35937; </span><span class="org-comment-delimiter">--&gt;</span>
${param.data}              <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">request.getParameter("data") </span><span class="org-comment-delimiter">--&gt;</span>
${header[<span class="org-string">"user-agent"</span>]     <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">request.getHeader("user-agent") </span><span class="org-comment-delimiter">--&gt;</span>
${cookie.JSESSIONID.value} <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">for (Cookie cookie : req.getCookies()) { </span><span class="org-comment-delimiter">--&gt;</span>
                           <span class="org-comment-delimiter">&lt;!--     </span><span class="org-comment">if (cookie.getName().equals("JSESSIONID")) { </span><span class="org-comment-delimiter">--&gt;</span>
                           <span class="org-comment-delimiter">&lt;!--         </span><span class="org-comment">return cookie.getValue(); </span><span class="org-comment-delimiter">--&gt;</span>
                           <span class="org-comment-delimiter">&lt;!--     </span><span class="org-comment">} </span><span class="org-comment-delimiter">--&gt;</span>
                           <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">} </span><span class="org-comment-delimiter">--&gt;</span>

<span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#33719;&#21462; request &#23545;&#35937;&#65292;&#24182;&#35843;&#29992; request &#30340;&#20854;&#20182;&#26041;&#27861;: </span><span class="org-comment-delimiter">--&gt;</span>
${pageContext.request.contextPath}
${pageContext.request.getContextPath()}

<span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">EL &#34920;&#36798;&#24335;&#21487;&#20197;&#20801;&#35768;&#31616;&#21333;&#30340;&#35745;&#31639; </span><span class="org-comment-delimiter">--&gt;</span>
${(age + 1) * 2}
${empty age}                       <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">&#21028;&#26029;&#26159;&#21542;&#20026;&#31354; </span><span class="org-comment-delimiter">--&gt;</span>
${age &gt; 18 ? <span class="org-string">"&#20320;&#30340;&#24180;&#40836;&#22826;&#22823;!"</span> : age} <span class="org-comment-delimiter">&lt;!-- </span><span class="org-comment">if/else &#34920;&#36798;&#24335; </span><span class="org-comment-delimiter">--&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org02fc594" class="outline-3">
<h3 id="org02fc594"><span class="section-number-3">4.6</span> JSTL 标准标签库</h3>
<div class="outline-text-3" id="text-4-6">
<p>
jar 包:
</p>
<pre class="example">
javax.servlet:jstl:1.2
</pre>

<p>
功能:
</p>
<ul class="org-ul">
<li>核心标签</li>
<li>格式化标签</li>
<li>SQL/XML 标签</li>
<li>JSTL 函数</li>
</ul>

<p>
使用例子:
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;%@ taglib <span class="org-variable-name">prefix</span>=<span class="org-string">"c"</span> <span class="org-variable-name">uri</span>=<span class="org-string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;

&lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">forEach</span> <span class="org-variable-name">items</span>=<span class="org-string">"${books}"</span> <span class="org-variable-name">var</span>=<span class="org-string">"x"</span> <span class="org-variable-name">varStatus</span>=<span class="org-string">"s"</span> <span class="org-variable-name">begin</span>=<span class="org-string">"0"</span> <span class="org-variable-name">end</span>=<span class="org-string">"4"</span> <span class="org-variable-name">step</span>=<span class="org-string">"1"</span>&gt;
    &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">if</span> <span class="org-variable-name">test</span>=<span class="org-string">"${x.amount &gt; 20}"</span>&gt;
        &lt;<span class="org-function-name">tr</span> <span class="org-variable-name">style</span>=<span class="org-string">"background: ${s.count % 2 == 0 ? "</span>pink<span class="org-string">" : "</span>yellow<span class="org-string">"}"</span>&gt;
            &lt;<span class="org-function-name">td</span>&gt;${s.index + 1} / ${s.count}&lt;/<span class="org-function-name">td</span>&gt;
            &lt;<span class="org-function-name">td</span>&gt;${x.id}&lt;/<span class="org-function-name">td</span>&gt;
            &lt;<span class="org-function-name">td</span>&gt;${x.name}&lt;/<span class="org-function-name">td</span>&gt;
            &lt;<span class="org-function-name">td</span> <span class="org-variable-name">style</span>=<span class="org-string">"color: ${x.price &gt; 100 ? "</span>green<span class="org-string">" : "</span>purple<span class="org-string">"}"</span>&gt;${x.price}&lt;/<span class="org-function-name">td</span>&gt;
            &lt;<span class="org-function-name">td</span>&gt;${x.amount}&lt;/<span class="org-function-name">td</span>&gt;
        &lt;/<span class="org-function-name">tr</span>&gt;
    &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">if</span>&gt;
&lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">forEach</span>&gt;
</pre>
</div>

<p>
更全面的例子:
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;%@ taglib <span class="org-variable-name">prefix</span>=<span class="org-string">"c"</span> <span class="org-variable-name">uri</span>=<span class="org-string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;
&lt;%@ taglib <span class="org-variable-name">prefix</span>=<span class="org-string">"fn"</span> <span class="org-variable-name">uri</span>=<span class="org-string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;
&lt;%@ taglib <span class="org-variable-name">prefix</span>=<span class="org-string">"fmt"</span> <span class="org-variable-name">uri</span>=<span class="org-string">"http://java.sun.com/jsp/jstl/fmt"</span> %&gt;

&lt;<span class="org-function-name">div</span>&gt;
  &lt;<span class="org-function-name">table</span> <span class="org-variable-name">class</span>=<span class="org-string">"tb"</span>&gt;
    &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">set</span> <span class="org-variable-name">var</span>=<span class="org-string">"ccc"</span> <span class="org-variable-name">scope</span>=<span class="org-string">"page"</span> <span class="org-variable-name">property</span>=<span class="org-string">"ccc"</span> <span class="org-variable-name">value</span>=<span class="org-string">"0"</span>/&gt;
    &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">forEach</span> <span class="org-variable-name">items</span>=<span class="org-string">"${books}"</span> <span class="org-variable-name">var</span>=<span class="org-string">"x"</span> <span class="org-variable-name">varStatus</span>=<span class="org-string">"s"</span> <span class="org-variable-name">begin</span>=<span class="org-string">"0"</span> <span class="org-variable-name">end</span>=<span class="org-string">"4"</span> <span class="org-variable-name">step</span>=<span class="org-string">"1"</span>&gt;
      &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">if</span> <span class="org-variable-name">test</span>=<span class="org-string">"${x.amount &gt; 20}"</span>&gt;
        &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">set</span> <span class="org-variable-name">value</span>=<span class="org-string">"${ccc + 1}"</span> <span class="org-variable-name">var</span>=<span class="org-string">"ccc"</span>/&gt;
        &lt;<span class="org-function-name">tr</span> <span class="org-variable-name">style</span>=<span class="org-string">"background: ${s.count % 2 == 0 ? "</span>pink<span class="org-string">" : "</span>yellow<span class="org-string">"}"</span>&gt;
          &lt;<span class="org-function-name">td</span>&gt;${s.index + 1} / ${s.count} / ${ccc}&lt;/<span class="org-function-name">td</span>&gt;
          &lt;<span class="org-function-name">td</span>&gt;${x.id}&lt;/<span class="org-function-name">td</span>&gt;
          &lt;<span class="org-function-name">td</span>&gt;${x.name}&lt;/<span class="org-function-name">td</span>&gt;
          &lt;<span class="org-function-name">td</span> <span class="org-variable-name">style</span>=<span class="org-string">"color: ${x.price &gt; 100 ? "</span>green<span class="org-string">" : "</span>purple<span class="org-string">"}"</span>&gt;${x.price}&lt;/<span class="org-function-name">td</span>&gt;
          &lt;<span class="org-function-name">td</span>&gt;${x.amount}&lt;/<span class="org-function-name">td</span>&gt;
        &lt;/<span class="org-function-name">tr</span>&gt;
      &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">if</span>&gt;
    &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">forEach</span>&gt;
  &lt;/<span class="org-function-name">table</span>&gt;
&lt;/<span class="org-function-name">div</span>&gt;

&lt;<span class="org-function-name">div</span>&gt;
  &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">out</span> <span class="org-variable-name">value</span>=<span class="org-string">"${name}"</span> <span class="org-variable-name">default</span>=<span class="org-string">"3333"</span>/&gt;
  ${empty name ? <span class="org-string">"3333"</span> : name}
&lt;/<span class="org-function-name">div</span>&gt;

&lt;<span class="org-function-name">div</span>&gt;
  &lt;%--    &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">redirect</span> <span class="org-variable-name">url</span>=<span class="org-string">"http://www.bing.com"</span> /&gt;--%&gt;
  &lt;%--    request.setAttribute(<span class="org-string">"xxx"</span>, 333) --%&gt;
  &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">set</span> <span class="org-variable-name">var</span>=<span class="org-string">"xxx"</span> <span class="org-variable-name">scope</span>=<span class="org-string">"session"</span> <span class="org-variable-name">property</span>=<span class="org-string">"xxx"</span> <span class="org-variable-name">value</span>=<span class="org-string">"333"</span>/&gt;
&lt;/<span class="org-function-name">div</span>&gt;

&lt;<span class="org-function-name">div</span>&gt;
  &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">forTokens</span> <span class="org-variable-name">items</span>=<span class="org-string">"aaa,bbb,ccc,ddd,eee"</span> <span class="org-variable-name">delims</span>=<span class="org-string">","</span> <span class="org-variable-name">var</span>=<span class="org-string">"t"</span> <span class="org-variable-name">varStatus</span>=<span class="org-string">"s"</span>&gt;
    &lt;<span class="org-function-name">li</span>&gt;${s.count}. ${t}&lt;/<span class="org-function-name">li</span>&gt;
  &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">forTokens</span>&gt;
&lt;/<span class="org-function-name">div</span>&gt;

&lt;<span class="org-function-name">div</span>&gt;
  &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">forEach</span> <span class="org-variable-name">var</span>=<span class="org-string">"b"</span> <span class="org-variable-name">items</span>=<span class="org-string">"${books}"</span>&gt;
    &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">choose</span>&gt;
      &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">when</span> <span class="org-variable-name">test</span>=<span class="org-string">"${b.price &gt; 100}"</span>&gt;
        &lt;<span class="org-function-name">li</span>&gt;${b.name} &#30340;&#20215;&#26684;&#22823;&#20110; 100&lt;/<span class="org-function-name">li</span>&gt;
      &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">when</span>&gt;
      &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">when</span> <span class="org-variable-name">test</span>=<span class="org-string">"${b.price &lt;= 100 &amp;&amp; b.price &gt; 50}"</span>&gt;
        &lt;<span class="org-function-name">li</span>&gt;${b.name} &#24182;&#19981;&#36149;&lt;/<span class="org-function-name">li</span>&gt;
      &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">when</span>&gt;
      &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">otherwise</span>&gt;
        &lt;<span class="org-function-name">li</span>&gt;&#12298;${b.name}&#12299;&#22826;&#20415;&#23452;&#20102;&#65292;&#20415;&#23452;&#27809;&#22909;&#36135;&lt;/<span class="org-function-name">li</span>&gt;
      &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">otherwise</span>&gt;
    &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">choose</span>&gt;
  &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">forEach</span>&gt;
&lt;/<span class="org-function-name">div</span>&gt;

&lt;<span class="org-function-name">div</span>&gt;
  &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">url</span> <span class="org-variable-name">var</span>=<span class="org-string">"womendelink"</span> <span class="org-variable-name">value</span>=<span class="org-string">"/student/lst"</span>&gt;
    &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">param</span> <span class="org-variable-name">name</span>=<span class="org-string">"id"</span> <span class="org-variable-name">value</span>=<span class="org-string">"3"</span>/&gt;
    &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">param</span> <span class="org-variable-name">name</span>=<span class="org-string">"xx"</span> <span class="org-variable-name">value</span>=<span class="org-string">"hello world"</span>/&gt;
    &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">param</span> <span class="org-variable-name">name</span>=<span class="org-string">"yy"</span> <span class="org-variable-name">value</span>=<span class="org-string">"&#19978;&#23707;&#21654;&#21857;"</span>/&gt;
  &lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">url</span>&gt;

  &lt;%--    &lt;<span class="org-function-name">a</span> <span class="org-variable-name">href</span>=<span class="org-string">"${pageContext.request.contextPath}/student/lst/?id=3&amp;name=skdfjksdjf&amp;xxx=skdfjdks%20skdfjksdf"</span>&gt;&#36229;&#38142;&#25509;&lt;/<span class="org-function-name">a</span>&gt;--%&gt;
  &lt;<span class="org-function-name">a</span> <span class="org-variable-name">href</span>=<span class="org-string">"${womendelink}"</span>&gt;&#20351;&#29992; url &#23450;&#20041;&#30340;&#21464;&#37327;&lt;/<span class="org-function-name">a</span>&gt;
&lt;/<span class="org-function-name">div</span>&gt;

&lt;<span class="org-function-name">div</span>&gt;
  &lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">import</span> <span class="org-variable-name">var</span>=<span class="org-string">"wodeyemian"</span> <span class="org-variable-name">url</span>=<span class="org-string">"footer.jsp"</span>/&gt;
&lt;/<span class="org-function-name">div</span>&gt;

&lt;<span class="org-function-name">div</span>&gt;
  ${wodeyemian}
&lt;/<span class="org-function-name">div</span>&gt;

&lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">if</span> <span class="org-variable-name">test</span>=<span class="org-string">"${fn:contains(name, 'd,')}"</span>&gt;xxx&lt;/<span class="org-sgml-namespace">c</span>:<span class="org-function-name">if</span>&gt;

&lt;%--&#24120;&#29992;&#30340;&#26684;&#24335;&#21270;&#26631;&#31614;--%&gt;

&lt;<span class="org-function-name">div</span>&gt;
  &lt;<span class="org-sgml-namespace">fmt</span>:<span class="org-function-name">formatDate</span> <span class="org-variable-name">value</span>=<span class="org-string">"${ddd}"</span> <span class="org-variable-name">pattern</span>=<span class="org-string">"yyyy-MM-dd HH:mm:ss"</span>/&gt;
&lt;/<span class="org-function-name">div</span>&gt;

&lt;<span class="org-function-name">div</span>&gt;
  &lt;<span class="org-sgml-namespace">fmt</span>:<span class="org-function-name">formatNumber</span> <span class="org-variable-name">value</span>=<span class="org-string">"2323232323"</span> <span class="org-variable-name">pattern</span>=<span class="org-string">"####,####"</span>/&gt;
&lt;/<span class="org-function-name">div</span>&gt;

</pre>
</div>
</div>
</div>

<div id="outline-container-org4003803" class="outline-3">
<h3 id="org4003803"><span class="section-number-3">4.7</span> 将其他页面包含到本页面</h3>
<div class="outline-text-3" id="text-4-7">
<p>
三种方式:
</p>
<ul class="org-ul">
<li>&lt;%@include&gt;   JSP 指令，直接了当将 xxx.jsp 拷贝到当前位置，然后再出将新的 jsp 进行编译处理</li>
<li>&lt;jsp:include&gt; JSP 动作，先去渲染当前 jsp，再去渲染 xxx.jsp，然后将 xxx.jsp 的结果放到当前位置</li>
<li>&lt;c:import&gt;</li>
</ul>

<div class="org-src-container">
<pre class="src src-html">&lt;%-- &lt;<span class="org-sgml-namespace">jsp</span>:<span class="org-function-name">include</span> <span class="org-variable-name">page</span>=<span class="org-string">"listCart.jsp"</span> /&gt;--%&gt;
&lt;%-- &lt;%@include <span class="org-variable-name">file</span>=<span class="org-string">"listCart.jsp"</span>%&gt;--%&gt;
&lt;<span class="org-sgml-namespace">c</span>:<span class="org-function-name">import</span> <span class="org-variable-name">url</span>=<span class="org-string">"listCart.jsp"</span> /&gt;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-orgbab26bd" class="outline-2">
<h2 id="orgbab26bd"><span class="section-number-2">5</span> Cookie/Session</h2>
<div class="outline-text-2" id="text-5">
<p>
Web 请求是基于 HTTP 协议的。
</p>

<p>
HTTP 协议最大的一个特点，就是<b>无状态</b>的。
</p>
<ul class="org-ul">
<li>一个请求是谁发送的，服务端压根不会理会</li>
<li>如果同一个人发送多个请求给服务器，服务器是不会认出来的</li>
</ul>

<p>
但是，在实际的业务中，我们却需要服务器能够识别出不同人的请求。
</p>

<p>
比如说，购物，那么一个人登录、浏览网站之后，所有的操作都应该聚合起来。你分很多次请求，加入购物车，最后买单。
</p>

<p>
我们我们就需要一定的手段，能够让整个 web 请求跟踪用户的操作，这就是所谓的<b>会话</b>。
</p>

<p>
实际的过程中，基于 HTTP 的会话跟踪手段有很多，其中最重要的是:
</p>
<ol class="org-ol">
<li>Cookie</li>
<li>URL 重写</li>
</ol>
</div>

<div id="outline-container-org7eca1a2" class="outline-3">
<h3 id="org7eca1a2"><span class="section-number-3">5.1</span> Cookie</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Cookie，小饼干的意思。基本是被所有浏览器支持的。
</p>

<p>
Cookie，本身是浏览器保存在<b>本地</b>的一段数据，这段数据有这些字段:
</p>
<ul class="org-ul">
<li>Name/Value</li>
<li>Domain/Expires, 过期时间，如果不设置的话，就是浏览器没关闭的时间。如果这个值设为负数，那么立刻无效</li>
</ul>

<p>
Cookie 保存的数据:
</p>
<ul class="org-ul">
<li>保存在客户端</li>
<li>明文保存的文本，不安全 (HttpOnly)</li>
<li>大约 4k 左右</li>
</ul>

<p>
Cookie 是可以直接使用 JS 进行操控的:
</p>
<div class="org-src-container">
<pre class="src src-js">console.log(document.cookie);  <span class="org-comment-delimiter">// </span><span class="org-comment">&#21482;&#20250;&#26174;&#31034;&#25152;&#26377;&#38750; HttpOnly &#30340; cookie</span>
document.cookie = <span class="org-string">"aaa=111"</span>;   <span class="org-comment-delimiter">// </span><span class="org-comment">&#35774;&#32622; cookie</span>
document.cookie = <span class="org-string">"bbb=222;max-age=3600"</span>;  <span class="org-comment-delimiter">// </span><span class="org-comment">&#35774;&#32622; cookie&#65292;&#25351;&#23450;&#26377;&#25928;&#26399;&#20026; 1 &#23567;&#26102;</span>
</pre>
</div>

<p>
可以使用 Servlet，在响应结果的时候，让浏览器刷新自己的 cookie。它本质就是在 http 的请求头部添加 <code>Set-Cookie</code> 字段:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-type">Cookie</span> <span class="org-variable-name">cookie1</span> = <span class="org-keyword">new</span> <span class="org-type">Cookie</span>(<span class="org-string">"xxx"</span>, <span class="org-string">"111"</span>);
cookie1.setHttpOnly(<span class="org-constant">true</span>);
resp.addCookie(cookie1);

<span class="org-type">Cookie</span> <span class="org-variable-name">cookie2</span> = <span class="org-keyword">new</span> <span class="org-type">Cookie</span>(<span class="org-string">"yyy"</span>, <span class="org-string">"222"</span>);
cookie2.setHttpOnly(<span class="org-constant">false</span>);
cookie2.setMaxAge(33333333);
resp.addCookie(cookie2);
</pre>
</div>
</div>
</div>

<div id="outline-container-org4540278" class="outline-3">
<h3 id="org4540278"><span class="section-number-3">5.2</span> Session</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Session 本质上是用户保存在<b>服务端</b>的数据:
</p>
<ul class="org-ul">
<li>基本是没有大小限制的</li>
<li>没有类型的限制</li>
<li>Session 的机制<b>一般</b>来说，是基于 Cookie 的</li>
</ul>

<p>
除了基于 Cookie，还可以基于 URL-Rewrite 方式。
</p>

<p>
Session 的基本操作如下:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">&#33719;&#21462;&#29992;&#25143;&#30340; session &#23545;&#35937;</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">&#22914;&#26524;&#26159;&#31532;&#19968;&#27425;&#25191;&#34892;&#36825;&#20010;&#65292;&#20250;&#26681;&#25454;&#26159;&#21542;&#26377; JSESSIONID &#33258;&#21160;&#21019;&#24314;&#65292;&#21542;&#21017;&#36820;&#22238;</span>
<span class="org-type">Session</span> <span class="org-variable-name">session</span> = req.getSession();

<span class="org-comment-delimiter">// </span><span class="org-comment">&#21028;&#26029; session &#26159;&#19981;&#26159;&#26032;&#21019;&#24314;&#30340;</span>
session.isNew();

<span class="org-comment-delimiter">// </span><span class="org-comment">&#25968;&#25454;&#30340;&#23384;&#21462;</span>
session.setAttribute(<span class="org-string">"aaa"</span>, <span class="org-string">"111"</span>);
session.getAttribute(<span class="org-string">"aaa"</span>);

<span class="org-comment-delimiter">// </span><span class="org-comment">&#25968;&#25454;&#30340;&#31227;&#38500;</span>
session.removeAttribute(<span class="org-string">"aaa"</span>);
session.invalidate(); <span class="org-comment-delimiter">// </span><span class="org-comment">&#31227;&#38500;&#25152;&#26377;</span>
</pre>
</div>

<p>
设置 Session 的有效期，可以使用 <code>session.setMaxInactiveInterval(333)</code> 方法，也可以在 web.xml 中配置。注意 setMaxInactiveInterval 的单位是<b>秒</b>，但 session-timeout 的单位是<b>分钟</b>:
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span class="org-function-name">session-config</span>&gt;
  &lt;<span class="org-function-name">session-timeout</span>&gt;10&lt;/<span class="org-function-name">session-timeout</span>&gt;
&lt;/<span class="org-function-name">session-config</span>&gt;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-orgf163059" class="outline-2">
<h2 id="orgf163059"><span class="section-number-2">6</span> 文件的上传和下载</h2>
</section>
<section id="outline-container-orgaf79d1c" class="outline-2">
<h2 id="orgaf79d1c"><span class="section-number-2">7</span> 用户的注册和登录</h2>
</section>
<section id="outline-container-org3c9f3e9" class="outline-2">
<h2 id="org3c9f3e9"><span class="section-number-2">8</span> 完整的增删改查实现</h2>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: yaowuer</p>
<p class="date">Created: 2019-07-26 Fri 01:37</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
